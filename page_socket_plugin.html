<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cc_tools_qt: Developing Custom Socket Plugin</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">cc_tools_qt
   </div>
   <div id="projectbrief">Common Environment for Protocol Analysis.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Developing Custom Socket Plugin</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#page_socket_plugin_socket_class">Socket Class</a><ul><li class="level2"><a href="#page_socket_plugin_connection">Connection / Disconnection</a></li>
<li class="level2"><a href="#page_socket_plugin_data_recv">Data Reception</a></li>
<li class="level2"><a href="#page_socket_plugin_data_send">Sending Data</a></li>
<li class="level2"><a href="#page_socket_plugin_errors">Reporting Errors</a></li>
</ul>
</li>
<li class="level1"><a href="#page_socket_plugin_plugin_class">Plugin Class</a></li>
</ul>
</div>
<div class="textblock"><p>The <b>socket</b> plugin is responsible to send the data over I/O link when requested as well as report any incoming data via callback. The <a href="https://github.com/commschamp/cc_tools_qt">CommsChampion Tools Project</a> contains implementation of multiple available <a href="https://github.com/commschamp/cc_tools_qt/tree/master/plugin">plugins</a> It is recommended to follow this tutorial while looking at available examples. The easy ones are <a href="https://github.com/commschamp/cc_tools_qt/tree/master/plugin/null_socket">null_socket</a> and <a href="https://github.com/commschamp/cc_tools_qt/tree/master/plugin/echo_socket">echo_socket</a></p>
<h1><a class="anchor" id="page_socket_plugin_socket_class"></a>
Socket Class</h1>
<p>To implement the required functionality the plugin's code must define its socket class inheriting from <a class="el" href="classcc__tools__qt_1_1Socket.html" title="Main polymorphic interface class for sockets.">cc_tools_qt::Socket</a>. </p><div class="fragment"><div class="line"><span class="keyword">class </span>MySocket : <span class="keyword">public</span> <a class="code hl_class" href="classcc__tools__qt_1_1Socket.html">cc_tools_qt::Socket</a></div>
<div class="line">{</div>
<div class="line">    ...</div>
<div class="line">};</div>
<div class="ttc" id="aclasscc__tools__qt_1_1Socket_html"><div class="ttname"><a href="classcc__tools__qt_1_1Socket.html">cc_tools_qt::Socket</a></div><div class="ttdoc">Main polymorphic interface class for sockets.</div><div class="ttdef"><b>Definition</b> Socket.h:39</div></div>
</div><!-- fragment --><p> If socket implementation uses Qt signals/slots infrastructure, it can use multiple inheritance and extend <b>QObject</b> as well. </p><div class="fragment"><div class="line"><span class="keyword">class </span>MySocket : <span class="keyword">public</span> QObject, <span class="keyword">public</span> <a class="code hl_class" href="classcc__tools__qt_1_1Socket.html">cc_tools_qt::Socket</a></div>
<div class="line">{</div>
<div class="line">    Q_OBJECT</div>
<div class="line">    ...</div>
<div class="line">private slots:</div>
<div class="line">    ...</div>
<div class="line">};</div>
</div><!-- fragment --><p> The <a class="el" href="classcc__tools__qt_1_1Socket.html" title="Main polymorphic interface class for sockets.">cc_tools_qt::Socket</a> class is implemented using <br  />
 <a href="https://en.wikibooks.org/wiki/More_C%2B%2B_Idioms/Non-Virtual_Interface">Non-Virtual Interface Idiom</a> It's non-virtual public interface is used by the driving application. The inheriting class needs to implement virtual <b>*Impl</b>() functions to override the default behaviour.</p>
<h2><a class="anchor" id="page_socket_plugin_connection"></a>
Connection / Disconnection</h2>
<p>The actual socket class is expected to override virtual <a class="el" href="classcc__tools__qt_1_1Socket.html#a01824c2216b460b8b039c11a79007777" title="Polymorphic socket connection functionality implementation.">cc_tools_qt::Socket::socketConnectImpl()</a> and <a class="el" href="classcc__tools__qt_1_1Socket.html#ab1aa4d8da6746904301e4d576cd58b57" title="Polymorphic socket disconnection functionality implementation.">cc_tools_qt::Socket::socketDisconnectImpl()</a> functions. </p><div class="fragment"><div class="line"><span class="keyword">class </span>MySocket : <span class="keyword">public</span> <a class="code hl_class" href="classcc__tools__qt_1_1Socket.html">cc_tools_qt::Socket</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    MySocket();</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="classcc__tools__qt_1_1Socket.html#a01824c2216b460b8b039c11a79007777">socketConnectImpl</a>() <span class="keyword">override</span>;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="classcc__tools__qt_1_1Socket.html#ab1aa4d8da6746904301e4d576cd58b57">socketDisconnectImpl</a>() <span class="keyword">override</span>;</div>
<div class="line">};</div>
<div class="ttc" id="aclasscc__tools__qt_1_1Socket_html_a01824c2216b460b8b039c11a79007777"><div class="ttname"><a href="classcc__tools__qt_1_1Socket.html#a01824c2216b460b8b039c11a79007777">cc_tools_qt::Socket::socketConnectImpl</a></div><div class="ttdeci">virtual bool socketConnectImpl()</div><div class="ttdoc">Polymorphic socket connection functionality implementation.</div></div>
<div class="ttc" id="aclasscc__tools__qt_1_1Socket_html_ab1aa4d8da6746904301e4d576cd58b57"><div class="ttname"><a href="classcc__tools__qt_1_1Socket.html#ab1aa4d8da6746904301e4d576cd58b57">cc_tools_qt::Socket::socketDisconnectImpl</a></div><div class="ttdeci">virtual void socketDisconnectImpl()</div><div class="ttdoc">Polymorphic socket disconnection functionality implementation.</div></div>
</div><!-- fragment --><p> The <b>connection</b> request is used to open the device file or low level I/O socket, as well as to connect to remote host in case of network socket, such as <a href="https://github.com/commschamp/cc_tools_qt/tree/master/plugin/tcp_socket/client">TCP/IP Client</a>.</p>
<p>When <b>disconnection</b> request comes in, the socket object is expected to disconnect from remote host (if applicable), and close the low level I/O socket.</p>
<p>Sometimes the unsolicited low level I/O socket disconnection can be detected. In this case, the socket object must use inherited <a class="el" href="classcc__tools__qt_1_1Socket.html#a9c7373520a180aa8498cffe590ad7626" title="Report socket disconnection.">cc_tools_qt::Socket::reportDisconnected()</a> member function to report it to the running application. The latter will report it to the user.</p>
<p><b>NOTE</b>, that during requested disconnection (inside overriden <b>socketDisconnectImpl()</b>) the socket class must NOT report the disconnection using the decribed above function. It should be used only to report <b>unsolicited</b> one.</p>
<h2><a class="anchor" id="page_socket_plugin_data_recv"></a>
Data Reception</h2>
<p>The <b>socket</b> object is expected to detect and report incoming data. It must be done <b>asynchronously</b>, hence it is recommended to use available signal/slot mechanism provided by the Qt framework. However, if can also be done using other third party code. In this case it is recommended to do such thing in separate thread (especially if there are blocking calls involved) and communicate the updates to the main thread using the same signal/slot facility.</p>
<p>When new data arrival is detected, the <b>socket</b> object needs to report it using inherited <a class="el" href="classcc__tools__qt_1_1Socket.html#ab9ad8af4ec99d915f3e4759b6b2bff1e" title="Report new data has been received.">cc_tools_qt::Socket::reportDataReceived()</a> function. Note, that the latter receives single parameter of type <a class="el" href="namespacecc__tools__qt.html#ac0ac73d5a1975385f1b9804aa22698da" title="Pointer to DataInfo.">cc_tools_qt::DataInfoPtr</a>. It is <b>std::shared_ptr</b> to <a class="el" href="structcc__tools__qt_1_1DataInfo.html" title="Information about incomming or outdoing data.">cc_tools_qt::DataInfo</a>. Please use <a class="el" href="namespacecc__tools__qt.html#ae340d2f896aefc1147f7b5225302a799" title="Dynamically allocate DataInfo and return in in DataInfoPtr;.">cc_tools_qt::makeDataInfo()</a> function to allocate one. The <a class="el" href="structcc__tools__qt_1_1DataInfo.html" title="Information about incomming or outdoing data.">cc_tools_qt::DataInfo</a> contains three data members: </p><ul>
<li><b>m_timestamp</b> - timestamp when data is received </li>
<li><b>m_data</b> - raw bytes data </li>
<li><b>m_extraProperties</b> - optional extra information about the data.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">class </span>MySocket : <span class="keyword">public</span> ...</div>
<div class="line">{</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="comment">// internal member function to be called when new data arrives</span></div>
<div class="line">    <span class="keywordtype">void</span> dataReceived(<span class="keyword">const</span> std::uint8_t* buf, std::size_t len)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> data = <a class="code hl_function" href="namespacecc__tools__qt.html#ae340d2f896aefc1147f7b5225302a799">cc_tools_qt::makeDataInfo</a>();</div>
<div class="line">        data-&gt;m_timestamp = cc_tools_qt::DataInfo::TimestampClock::now();</div>
<div class="line">        data-&gt;m_data.assign(buf, buf + len);</div>
<div class="line">        <a class="code hl_function" href="classcc__tools__qt_1_1Socket.html#ab9ad8af4ec99d915f3e4759b6b2bff1e">reportDataReceived</a>(std::move(data));</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="aclasscc__tools__qt_1_1Socket_html_ab9ad8af4ec99d915f3e4759b6b2bff1e"><div class="ttname"><a href="classcc__tools__qt_1_1Socket.html#ab9ad8af4ec99d915f3e4759b6b2bff1e">cc_tools_qt::Socket::reportDataReceived</a></div><div class="ttdeci">void reportDataReceived(DataInfoPtr dataPtr)</div><div class="ttdoc">Report new data has been received.</div></div>
<div class="ttc" id="anamespacecc__tools__qt_html_ae340d2f896aefc1147f7b5225302a799"><div class="ttname"><a href="namespacecc__tools__qt.html#ae340d2f896aefc1147f7b5225302a799">cc_tools_qt::makeDataInfo</a></div><div class="ttdeci">CC_API DataInfoPtr makeDataInfo()</div><div class="ttdoc">Dynamically allocate DataInfo and return in in DataInfoPtr;.</div></div>
</div><!-- fragment --><p> <b>NOTE</b>, that the assignment of the <b>m_timestamp</b> value can be omitted. If no value has been set, the inherited <b>reportDataReceived()</b> function will assign the value returned by call to <code>cc_tools_qt::DataInfo::TimestampClock::now()</code> prior to invoking the callback to report the data to the application.</p>
<p>Also note, that there is <b>m_extraProperties</b> data member which can contain any extra information about the data. For example, the IP address and port the data has arrived from in case of network socket. Such extra information can be reported by the driving application when reporting received message details. For example, take a look at <a href="https://github.com/commschamp/cc_tools_qt/blob/master/plugin/tcp_socket/server/TcpServerSocket.cpp">TCP/IP Server Socket</a> implementation.</p>
<h2><a class="anchor" id="page_socket_plugin_data_send"></a>
Sending Data</h2>
<p>The socket object receives requests to send outgoing data using call to overridden virtual <b>sendDataImpl()</b> (see <a class="el" href="classcc__tools__qt_1_1Socket.html#a6c6efe5130aae422dbc92bed81fea274" title="Polymorphic data send functionality implementation.">cc_tools_qt::Socket::sendDataImpl()</a>). </p><div class="fragment"><div class="line"><span class="keyword">class </span>MySocket : <span class="keyword">public</span> ...</div>
<div class="line">{</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="classcc__tools__qt_1_1Socket.html#a6c6efe5130aae422dbc92bed81fea274">sendDataImpl</a>(<a class="code hl_typedef" href="namespacecc__tools__qt.html#ac0ac73d5a1975385f1b9804aa22698da">cc_tools_qt::DataInfoPtr</a> dataPtr)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        ... <span class="comment">// write contents of dataPtr-&gt;m_data to I/O socket.</span></div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="aclasscc__tools__qt_1_1Socket_html_a6c6efe5130aae422dbc92bed81fea274"><div class="ttname"><a href="classcc__tools__qt_1_1Socket.html#a6c6efe5130aae422dbc92bed81fea274">cc_tools_qt::Socket::sendDataImpl</a></div><div class="ttdeci">virtual void sendDataImpl(DataInfoPtr dataPtr)=0</div><div class="ttdoc">Polymorphic data send functionality implementation.</div></div>
<div class="ttc" id="anamespacecc__tools__qt_html_ac0ac73d5a1975385f1b9804aa22698da"><div class="ttname"><a href="namespacecc__tools__qt.html#ac0ac73d5a1975385f1b9804aa22698da">cc_tools_qt::DataInfoPtr</a></div><div class="ttdeci">std::shared_ptr&lt; DataInfo &gt; DataInfoPtr</div><div class="ttdoc">Pointer to DataInfo.</div><div class="ttdef"><b>Definition</b> DataInfo.h:57</div></div>
</div><!-- fragment --><p> Note, that the parameter to the function is the same std::shared_ptr to <a class="el" href="structcc__tools__qt_1_1DataInfo.html" title="Information about incomming or outdoing data.">cc_tools_qt::DataInfo</a>. In addition to raw data bytes in may also contain extra properties. Depending on the socket, these properties can be used by the other plugins (<b>filters</b> and/or <b>protocol</b>) to provide extra information on how the data needs to be sent. For example, it can specify whether <a href="https://github.com/commschamp/cc_tools_qt/blob/master/plugin/udp_socket/Socket.cpp">UDP/IP Socket</a> needs to broadcast the provided data or send it directly to currently connected remote endpoint.</p>
<h2><a class="anchor" id="page_socket_plugin_errors"></a>
Reporting Errors</h2>
<p>If there is any error discovered, the socket object is expected to report them using inherited <a class="el" href="classcc__tools__qt_1_1Socket.html#a657bbe75546926d89584dd6169fd7b08" title="Report I/O operation error.">cc_tools_qt::Socket::reportError()</a> member function.</p>
<h1><a class="anchor" id="page_socket_plugin_plugin_class"></a>
Plugin Class</h1>
<p>Please read the <a class="el" href="page_plugin.html">Defining a Plugin</a> page first to understand the way the plugins are defined.</p>
<p>The <b>socket</b> plugin must provide a callback to allocate the <b>Socket</b> object (the one that is derived from <a class="el" href="classcc__tools__qt_1_1Socket.html" title="Main polymorphic interface class for sockets.">cc_tools_qt::Socket</a>). </p><div class="fragment"><div class="line"><span class="keyword">class </span>EchoSocketPlugin : <span class="keyword">public</span> <a class="code hl_class" href="classcc__tools__qt_1_1Plugin.html">cc_tools_qt::Plugin</a></div>
<div class="line">{</div>
<div class="line">    Q_OBJECT</div>
<div class="line">    Q_PLUGIN_METADATA(IID <span class="stringliteral">&quot;cc.EchoSocketPlugin&quot;</span> FILE <span class="stringliteral">&quot;echo_socket.json&quot;</span>)</div>
<div class="line">    Q_INTERFACES(<a class="code hl_class" href="classcc__tools__qt_1_1Plugin.html">cc_tools_qt::Plugin</a>)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    EchoSocketPlugin()</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_function" href="classcc__tools__qt_1_1Plugin.html#af72273227ee7b9e978a6903fdff77a51">pluginProperties</a>()</div>
<div class="line">            .<a class="code hl_function" href="classcc__tools__qt_1_1PluginProperties.html#a3a4f919c0e1f22c20a0a678d47385b2c">setSocketCreateFunc</a>(</div>
<div class="line">                [<span class="keyword">this</span>]()</div>
<div class="line">                {</div>
<div class="line">                    <span class="keywordflow">return</span> makeEchoSocket();</div>
<div class="line">                });</div>
<div class="line">    }</div>
<div class="line">            </div>
<div class="line">    ...</div>
<div class="line">};</div>
<div class="ttc" id="aclasscc__tools__qt_1_1PluginProperties_html_a3a4f919c0e1f22c20a0a678d47385b2c"><div class="ttname"><a href="classcc__tools__qt_1_1PluginProperties.html#a3a4f919c0e1f22c20a0a678d47385b2c">cc_tools_qt::PluginProperties::setSocketCreateFunc</a></div><div class="ttdeci">PluginProperties &amp; setSocketCreateFunc(SocketCreateFunc &amp;&amp;func)</div><div class="ttdoc">Assign callback for Socket allocation.</div></div>
<div class="ttc" id="aclasscc__tools__qt_1_1Plugin_html"><div class="ttname"><a href="classcc__tools__qt_1_1Plugin.html">cc_tools_qt::Plugin</a></div><div class="ttdoc">Interface class for plugin definition.</div><div class="ttdef"><b>Definition</b> Plugin.h:39</div></div>
<div class="ttc" id="aclasscc__tools__qt_1_1Plugin_html_af72273227ee7b9e978a6903fdff77a51"><div class="ttname"><a href="classcc__tools__qt_1_1Plugin.html#af72273227ee7b9e978a6903fdff77a51">cc_tools_qt::Plugin::pluginProperties</a></div><div class="ttdeci">PluginProperties &amp; pluginProperties()</div><div class="ttdoc">Get access to plugin properties.</div></div>
</div><!-- fragment --><p> If the socket requires configuration, please also provide a callback which creates the widget when invoked (see <a class="el" href="page_plugin.html#page_plugin_properties_config_widget">Configuration Widget</a>). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cc_tools_qt: Developing Custom Socket Plugin</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">cc_tools_qt
   </div>
   <div id="projectbrief">Common Environment for Protocol Analysis.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Developing Custom Socket Plugin</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#page_socket_plugin_socket_class">Socket Class</a><ul><li class="level2"><a href="#page_socket_plugin_connection">Connection / Disconnection</a></li>
<li class="level2"><a href="#page_socket_plugin_data_recv">Data Reception</a></li>
<li class="level2"><a href="#page_socket_plugin_data_send">Sending Data</a></li>
<li class="level2"><a href="#page_socket_plugin_errors">Reporting Errors</a></li>
</ul>
</li>
<li class="level1"><a href="#page_socket_plugin_plugin_class">Plugin Class</a></li>
</ul>
</div>
<div class="textblock"><p>The <b>socket</b> plugin is responsible to send the data over I/O link when requested as well as report any incoming data via callback. The <a href="https://github.com/commschamp/cc_tools_qt">CommsChampion Tools Project</a> contains implementation of multiple available <a href="https://github.com/commschamp/cc_tools_qt/tree/master/plugin">plugins</a> It is recommended to follow this tutorial while looking at available examples. The easy ones are <a href="https://github.com/commschamp/cc_tools_qt/tree/master/plugin/null_socket">null_socket</a> and <a href="https://github.com/commschamp/cc_tools_qt/tree/master/plugin/echo_socket">echo_socket</a></p>
<h1><a class="anchor" id="page_socket_plugin_socket_class"></a>
Socket Class</h1>
<p>To implement the required functionality the plugin's code must define its socket class inheriting from <a class="el" href="classcc__tools__qt_1_1ToolsSocket.html" title="Main polymorphic interface class for sockets.">cc_tools_qt::ToolsSocket</a>. </p><div class="fragment"><div class="line"><span class="keyword">class </span>MySocket : <span class="keyword">public</span> <a class="code hl_class" href="classcc__tools__qt_1_1ToolsSocket.html">cc_tools_qt::ToolsSocket</a></div>
<div class="line">{</div>
<div class="line">    ...</div>
<div class="line">};</div>
<div class="ttc" id="aclasscc__tools__qt_1_1ToolsSocket_html"><div class="ttname"><a href="classcc__tools__qt_1_1ToolsSocket.html">cc_tools_qt::ToolsSocket</a></div><div class="ttdoc">Main polymorphic interface class for sockets.</div><div class="ttdef"><b>Definition</b> ToolsSocket.h:40</div></div>
</div><!-- fragment --><p> If socket implementation uses Qt signals/slots infrastructure, it can use multiple inheritance and extend <b>QObject</b> as well. </p><div class="fragment"><div class="line"><span class="keyword">class </span>MySocket : <span class="keyword">public</span> QObject, <span class="keyword">public</span> <a class="code hl_class" href="classcc__tools__qt_1_1ToolsSocket.html">cc_tools_qt::ToolsSocket</a></div>
<div class="line">{</div>
<div class="line">    Q_OBJECT</div>
<div class="line">    ...</div>
<div class="line">private slots:</div>
<div class="line">    ...</div>
<div class="line">};</div>
</div><!-- fragment --><p> The <a class="el" href="classcc__tools__qt_1_1ToolsSocket.html" title="Main polymorphic interface class for sockets.">cc_tools_qt::ToolsSocket</a> class is implemented using <a href="https://en.wikibooks.org/wiki/More_C%2B%2B_Idioms/Non-Virtual_Interface">Non-Virtual Interface Idiom</a>. It's non-virtual public interface is used by the driving application. The inheriting class needs to implement virtual <b>*Impl</b>() functions to override the default behaviour.</p>
<h2><a class="anchor" id="page_socket_plugin_connection"></a>
Connection / Disconnection</h2>
<p>The actual socket class is expected to override virtual <a class="el" href="classcc__tools__qt_1_1ToolsSocket.html#a4cfe1fd67a6efa580e496ab113cc325f" title="Polymorphic socket connection functionality implementation.">cc_tools_qt::ToolsSocket::socketConnectImpl()</a> and <a class="el" href="classcc__tools__qt_1_1ToolsSocket.html#a5dcbc7b4824ce675f245220cb4c8d842" title="Polymorphic socket disconnection functionality implementation.">cc_tools_qt::ToolsSocket::socketDisconnectImpl()</a> functions. </p><div class="fragment"><div class="line"><span class="keyword">class </span>MySocket : <span class="keyword">public</span> <a class="code hl_class" href="classcc__tools__qt_1_1ToolsSocket.html">cc_tools_qt::ToolsSocket</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    MySocket();</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code hl_function" href="classcc__tools__qt_1_1ToolsSocket.html#a4cfe1fd67a6efa580e496ab113cc325f">socketConnectImpl</a>() <span class="keyword">override</span>;</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="classcc__tools__qt_1_1ToolsSocket.html#a5dcbc7b4824ce675f245220cb4c8d842">socketDisconnectImpl</a>() <span class="keyword">override</span>;</div>
<div class="line">};</div>
<div class="ttc" id="aclasscc__tools__qt_1_1ToolsSocket_html_a4cfe1fd67a6efa580e496ab113cc325f"><div class="ttname"><a href="classcc__tools__qt_1_1ToolsSocket.html#a4cfe1fd67a6efa580e496ab113cc325f">cc_tools_qt::ToolsSocket::socketConnectImpl</a></div><div class="ttdeci">virtual bool socketConnectImpl()</div><div class="ttdoc">Polymorphic socket connection functionality implementation.</div><div class="ttdef"><b>Definition</b> ToolsSocket.cpp:153</div></div>
<div class="ttc" id="aclasscc__tools__qt_1_1ToolsSocket_html_a5dcbc7b4824ce675f245220cb4c8d842"><div class="ttname"><a href="classcc__tools__qt_1_1ToolsSocket.html#a5dcbc7b4824ce675f245220cb4c8d842">cc_tools_qt::ToolsSocket::socketDisconnectImpl</a></div><div class="ttdeci">virtual void socketDisconnectImpl()</div><div class="ttdoc">Polymorphic socket disconnection functionality implementation.</div><div class="ttdef"><b>Definition</b> ToolsSocket.cpp:158</div></div>
</div><!-- fragment --><p> The <b>connection</b> request is used to open the device file or low level I/O socket, as well as to connect to remote host in case of network socket, such as <a href="https://github.com/commschamp/cc_tools_qt/tree/master/plugin/tcp_socket/client">TCP/IP Client</a>.</p>
<p>When <b>disconnection</b> request comes in, the socket object is expected to disconnect from remote host (if applicable), and close the low level I/O socket.</p>
<p>Sometimes the unsolicited low level I/O socket disconnection can be detected. In this case, the socket object must use inherited <a class="el" href="classcc__tools__qt_1_1ToolsSocket.html#ae4c8968d10689ce758004a34c46b5c3b" title="Report socket disconnection.">cc_tools_qt::ToolsSocket::reportDisconnected()</a> member function to report it to the running application. The latter will report it to the user.</p>
<p><b>NOTE</b>, that during requested disconnection (inside overriden <a class="el" href="classcc__tools__qt_1_1ToolsSocket.html#a5dcbc7b4824ce675f245220cb4c8d842">socketDisconnectImpl()</a>) the socket class must NOT report the disconnection using the decribed above function. It should be used only to report <b>unsolicited</b> one.</p>
<h2><a class="anchor" id="page_socket_plugin_data_recv"></a>
Data Reception</h2>
<p>The <b>socket</b> object is expected to detect and report incoming data. It must be done <b>asynchronously</b>, hence it is recommended to use available signal/slot mechanism provided by the Qt framework. However, if can also be done using other third party code. In this case it is recommended to do such thing in separate thread (especially if there are blocking calls involved) and communicate the updates to the main thread using the same signal/slot facility.</p>
<p>When new data arrival is detected, the <b>socket</b> object needs to report it using inherited <a class="el" href="classcc__tools__qt_1_1ToolsSocket.html#aefa16e4e878bf16425262215d002c389">cc_tools_qt::ToolsSocket::reportDataReceived()</a> function. Note, that the latter receives single parameter of type <a class="el" href="namespacecc__tools__qt.html#a0297e93cb19b022c612a0579c0de7aa1" title="Pointer to ToolsDataInfo.">cc_tools_qt::ToolsDataInfoPtr</a>. It is <b>std::shared_ptr</b> to <a class="el" href="structcc__tools__qt_1_1ToolsDataInfo.html" title="Information about incomming or outdoing data.">cc_tools_qt::ToolsDataInfo</a>. Please use <a class="el" href="namespacecc__tools__qt.html#a45ddf43ff559d79a60166b3a82c65e8f" title="Dynamically allocate ToolsDataInfo and return in in ToolsDataInfoPtr;.">cc_tools_qt::makeDataInfo()</a> function to allocate one. The <a class="el" href="structcc__tools__qt_1_1ToolsDataInfo.html" title="Information about incomming or outdoing data.">cc_tools_qt::ToolsDataInfo</a> contains three data members: </p><ul>
<li><a class="el" href="structcc__tools__qt_1_1ToolsDataInfo.html#a8a61a447d28ede21a9e665431b885f68">m_timestamp</a> - timestamp when data is received </li>
<li><a class="el" href="structcc__tools__qt_1_1ToolsDataInfo.html#a7d8f77ff63616b464601ab1737b4a8a2">m_data</a> - raw bytes data </li>
<li><a class="el" href="structcc__tools__qt_1_1ToolsDataInfo.html#a10fb8761a653de7009acffc3274d595e">m_extraProperties</a> - optional extra information about the data.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">class </span>MySocket : <span class="keyword">public</span> ...</div>
<div class="line">{</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="comment">// internal member function to be called when new data arrives</span></div>
<div class="line">    <span class="keywordtype">void</span> dataReceived(<span class="keyword">const</span> std::uint8_t* buf, std::size_t len)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> data = <a class="code hl_function" href="namespacecc__tools__qt.html#a45ddf43ff559d79a60166b3a82c65e8f">cc_tools_qt::makeDataInfo</a>();</div>
<div class="line">        data-&gt;m_timestamp = cc_tools_qt::ToolsDataInfo::TimestampClock::now();</div>
<div class="line">        data-&gt;m_data.assign(buf, buf + len);</div>
<div class="line">        <a class="code hl_slot" href="classcc__tools__qt_1_1ToolsSocket.html#aefa16e4e878bf16425262215d002c389">reportDataReceived</a>(std::move(data));</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="aclasscc__tools__qt_1_1ToolsSocket_html_aefa16e4e878bf16425262215d002c389"><div class="ttname"><a href="classcc__tools__qt_1_1ToolsSocket.html#aefa16e4e878bf16425262215d002c389">cc_tools_qt::ToolsSocket::reportDataReceived</a></div><div class="ttdeci">void reportDataReceived(ToolsDataInfoPtr dataPtr)</div><div class="ttdoc">Report new data has been received.</div><div class="ttdef"><b>Definition</b> ToolsSocket.cpp:185</div></div>
<div class="ttc" id="anamespacecc__tools__qt_html_a45ddf43ff559d79a60166b3a82c65e8f"><div class="ttname"><a href="namespacecc__tools__qt.html#a45ddf43ff559d79a60166b3a82c65e8f">cc_tools_qt::makeDataInfo</a></div><div class="ttdeci">CC_TOOLS_API ToolsDataInfoPtr makeDataInfo()</div><div class="ttdoc">Dynamically allocate ToolsDataInfo and return in in ToolsDataInfoPtr;.</div><div class="ttdef"><b>Definition</b> ToolsDataInfo.cpp:47</div></div>
</div><!-- fragment --><p> <b>NOTE</b>, that the assignment of the <b>m_timestamp</b> value can be omitted. If no value has been set, the inherited <a class="el" href="classcc__tools__qt_1_1ToolsSocket.html#aefa16e4e878bf16425262215d002c389">reportDataReceived()</a> function will assign the value returned by call to <code>cc_tools_qt::ToolsDataInfo::TimestampClock::now()</code> prior to invoking the callback to report the data to the application. Another options is to use <a class="el" href="namespacecc__tools__qt.html#a023609473c6aabdb9da12bbe32ee7d58">cc_tools_qt::makeDataInfoTimed()</a> instead of <a class="el" href="namespacecc__tools__qt.html#a45ddf43ff559d79a60166b3a82c65e8f">cc_tools_qt::makeDataInfo()</a>.</p>
<p>Also note, that there is <b>m_extraProperties</b> data member which can contain any extra information about the data. For example, the IP address and port the data has arrived from in case of network socket. Such extra information can be reported by the driving application when reporting received message details. For example, take a look at <a href="https://github.com/commschamp/cc_tools_qt/blob/master/plugin/tcp_socket/server/TcpServerSocket.cpp">TCP/IP Server Socket</a> implementation.</p>
<h2><a class="anchor" id="page_socket_plugin_data_send"></a>
Sending Data</h2>
<p>The socket object receives requests to send outgoing data using call to overridden virtual <a class="el" href="classcc__tools__qt_1_1ToolsSocket.html#aab924441e657617a53c757fe0462510d">sendDataImpl()</a>. </p><div class="fragment"><div class="line"><span class="keyword">class </span>MySocket : <span class="keyword">public</span> ...</div>
<div class="line">{</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code hl_function" href="classcc__tools__qt_1_1ToolsSocket.html#aab924441e657617a53c757fe0462510d">sendDataImpl</a>(<a class="code hl_typedef" href="namespacecc__tools__qt.html#a0297e93cb19b022c612a0579c0de7aa1">cc_tools_qt::ToolsDataInfoPtr</a> dataPtr)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        ... <span class="comment">// write contents of dataPtr-&gt;m_data to I/O socket.</span></div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="aclasscc__tools__qt_1_1ToolsSocket_html_aab924441e657617a53c757fe0462510d"><div class="ttname"><a href="classcc__tools__qt_1_1ToolsSocket.html#aab924441e657617a53c757fe0462510d">cc_tools_qt::ToolsSocket::sendDataImpl</a></div><div class="ttdeci">virtual void sendDataImpl(ToolsDataInfoPtr dataPtr)=0</div><div class="ttdoc">Polymorphic data send functionality implementation.</div></div>
<div class="ttc" id="anamespacecc__tools__qt_html_a0297e93cb19b022c612a0579c0de7aa1"><div class="ttname"><a href="namespacecc__tools__qt.html#a0297e93cb19b022c612a0579c0de7aa1">cc_tools_qt::ToolsDataInfoPtr</a></div><div class="ttdeci">std::shared_ptr&lt; ToolsDataInfo &gt; ToolsDataInfoPtr</div><div class="ttdoc">Pointer to ToolsDataInfo.</div><div class="ttdef"><b>Definition</b> ToolsDataInfo.h:57</div></div>
</div><!-- fragment --><p> Note, that the parameter to the function is the same <b>std::shared_ptr</b> to <a class="el" href="structcc__tools__qt_1_1ToolsDataInfo.html">cc_tools_qt::ToolsDataInfo</a>. In addition to raw data bytes in may also contain extra properties. Depending on the socket, these properties can be used by the other plugins (<b>filters</b> and/or <b>protocol</b>) to provide extra information on how the data needs to be sent. For example, it can specify whether <a href="https://github.com/commschamp/cc_tools_qt/blob/master/plugin/udp_socket/Socket.cpp">UDP/IP Socket</a> needs to broadcast the provided data or send it directly to currently connected remote endpoint.</p>
<h2><a class="anchor" id="page_socket_plugin_errors"></a>
Reporting Errors</h2>
<p>If there is any error discovered, the socket object is expected to report them using inherited <a class="el" href="classcc__tools__qt_1_1ToolsSocket.html#aa1d042c5be502bc04f18b74f1dc9cb19" title="Report I/O operation error.">cc_tools_qt::ToolsSocket::reportError()</a> member function.</p>
<h1><a class="anchor" id="page_socket_plugin_plugin_class"></a>
Plugin Class</h1>
<p>Please read the <a class="el" href="page_plugin.html">Defining a Plugin</a> page first to understand the way the plugins are defined.</p>
<p>The <b>socket</b> plugin must specify its type as <a class="el" href="classcc__tools__qt_1_1ToolsPlugin.html#a1cb38bdfddafbb4fb11dc32550ad3868ad1730a939092fd23401a047854f5e7cd">Type_Socket</a> and override <a class="el" href="classcc__tools__qt_1_1ToolsPlugin.html#a8291af99035982c2192f161a624c4ea0">createSocketImpl()</a> virtual member function. </p><div class="fragment"><div class="line"><span class="keyword">class </span>EchoSocketPlugin : <span class="keyword">public</span> <a class="code hl_class" href="classcc__tools__qt_1_1ToolsPlugin.html">cc_tools_qt::ToolsPlugin</a></div>
<div class="line">{</div>
<div class="line">    Q_OBJECT</div>
<div class="line">    Q_PLUGIN_METADATA(IID <span class="stringliteral">&quot;cc.EchoSocketPlugin&quot;</span> FILE <span class="stringliteral">&quot;echo_socket.json&quot;</span>)</div>
<div class="line">    Q_INTERFACES(<a class="code hl_class" href="classcc__tools__qt_1_1ToolsPlugin.html">cc_tools_qt::ToolsPlugin</a>)</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">using </span>Base = <a class="code hl_class" href="classcc__tools__qt_1_1ToolsPlugin.html">cc_tools_qt::ToolsPlugin</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    EchoSocketPlugin() : Base(Type_Socket) {}</div>
<div class="line">    ...</div>
<div class="line">protected:</div>
<div class="line">    <span class="keyword">virtual</span> <a class="code hl_typedef" href="namespacecc__tools__qt.html#ae7adccb7a6c1e5ce71d4efd4f0864e62">cc_tools_qt::ToolsSocketPtr</a> <a class="code hl_function" href="classcc__tools__qt_1_1ToolsPlugin.html#a8291af99035982c2192f161a624c4ea0">createSocketImpl</a>()<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">         <span class="keywordflow">return</span> makeEchoSocket();</div>
<div class="line">    }</div>
<div class="line">    ...</div>
<div class="line">};</div>
<div class="ttc" id="aclasscc__tools__qt_1_1ToolsPlugin_html"><div class="ttname"><a href="classcc__tools__qt_1_1ToolsPlugin.html">cc_tools_qt::ToolsPlugin</a></div><div class="ttdoc">Interface class for plugin definition.</div><div class="ttdef"><b>Definition</b> ToolsPlugin.h:42</div></div>
<div class="ttc" id="aclasscc__tools__qt_1_1ToolsPlugin_html_a8291af99035982c2192f161a624c4ea0"><div class="ttname"><a href="classcc__tools__qt_1_1ToolsPlugin.html#a8291af99035982c2192f161a624c4ea0">cc_tools_qt::ToolsPlugin::createSocketImpl</a></div><div class="ttdeci">virtual ToolsSocketPtr createSocketImpl()</div><div class="ttdoc">Create socket object.</div><div class="ttdef"><b>Definition</b> ToolsPlugin.cpp:175</div></div>
<div class="ttc" id="anamespacecc__tools__qt_html_ae7adccb7a6c1e5ce71d4efd4f0864e62"><div class="ttname"><a href="namespacecc__tools__qt.html#ae7adccb7a6c1e5ce71d4efd4f0864e62">cc_tools_qt::ToolsSocketPtr</a></div><div class="ttdeci">std::shared_ptr&lt; ToolsSocket &gt; ToolsSocketPtr</div><div class="ttdoc">Pointer to ToolsSocket object.</div><div class="ttdef"><b>Definition</b> ToolsSocket.h:217</div></div>
</div><!-- fragment --><p> If the socket requires configuration, please also provide a callback which creates the widget when invoked (see <a class="el" href="page_plugin.html#page_plugin_config_widget">Configuration Widget</a>). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
